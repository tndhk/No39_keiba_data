# Codemap Diff Report
Generated: 2026-01-24

## Summary

Overall Change Percentage: ~15%
Status: AUTO-APPROVED (under 30% threshold)

## Changes by File

### docs/CODEMAPS/architecture.md

Added Sections:
1. Test Structure (35 lines)
   - Complete test directory tree
   - All test files including new cli/, scrapers/ test directories
   - New files: test_predict_day.py, test_review_day.py, test_predict_review.py, test_race_detail_payouts.py

2. CLI Helper Functions table (7 lines)
   - _get_race_ids_for_venue()
   - _save_predictions_markdown()
   - _parse_predictions_markdown()
   - _calculate_fukusho_simulation()
   - _append_review_to_markdown()

3. Constants table (3 lines)
   - VENUE_CODE_MAP

Updated:
- Freshness timestamp updated

Lines Added: ~60
Lines Modified: 1
Change Percentage: ~33% increase

### docs/CODEMAPS/data.md

Added Sections:
1. Fukusho Simulation Data Structures (55 lines)
   - _calculate_fukusho_simulation Input/Output schema
   - predictions dict structure
   - actual_results dict structure
   - payouts dict structure
   - simulation result schema

2. CLI Internal Data Structures (20 lines)
   - VENUE_CODE_MAP constant
   - race_id Format documentation

Updated:
- Freshness timestamp updated

Lines Added: ~75
Lines Modified: 1
Change Percentage: ~22% increase

### docs/CODEMAPS/backend.md

Status: NOT CREATED
Note: backend.md was not in the original scope. The existing architecture.md
      covers backend functionality adequately.

## New Test Files Referenced

| File | Lines | Purpose |
|------|-------|---------|
| tests/cli/test_predict_day.py | 610 | predict-day command tests |
| tests/cli/test_review_day.py | 677 | review-day command tests |
| tests/cli/test_predict_review.py | 850 | Integration tests |
| tests/scrapers/test_race_detail_payouts.py | 277 | fetch_payouts tests |

Total New Test Lines: ~2,414

## Source Code Changes Referenced

### keiba/cli.py
New additions:
- VENUE_CODE_MAP constant (12 lines)
- predict_day command (~145 lines)
- review_day command (~120 lines)
- _get_race_ids_for_venue() (~22 lines)
- _save_predictions_markdown() (~95 lines)
- _parse_predictions_markdown() (~120 lines)
- _calculate_fukusho_simulation() (~80 lines)
- _append_review_to_markdown() (~65 lines)

### keiba/scrapers/race_detail.py
New additions:
- fetch_payouts() (~20 lines)
- _parse_fukusho_payouts() (~40 lines)
- _parse_br_separated_values() (~20 lines)

## Verification

All referenced files exist:
[x] tests/cli/test_predict_day.py
[x] tests/cli/test_review_day.py
[x] tests/cli/test_predict_review.py
[x] tests/scrapers/test_race_detail_payouts.py
[x] keiba/cli.py (VENUE_CODE_MAP, predict_day, review_day, helpers)
[x] keiba/scrapers/race_detail.py (fetch_payouts, _parse_fukusho_payouts)

## Freshness Timestamps

| File | Previous | Current |
|------|----------|---------|
| architecture.md | 2026-01-24 | 2026-01-24 |
| data.md | 2026-01-24 | 2026-01-24 |

---
End of Report
